package osmo.tester.unittests.optimizer;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import osmo.common.TestUtils;
import osmo.tester.OSMOConfiguration;
import osmo.tester.coverage.ScoreConfiguration;
import osmo.tester.coverage.TestCoverage;
import osmo.tester.generator.ReflectiveModelFactory;
import osmo.tester.generator.endcondition.LengthProbability;
import osmo.tester.generator.testsuite.TestCase;
import osmo.tester.model.ModelFactory;
import osmo.tester.model.TestModels;
import osmo.tester.optimizer.greedy.IterationListener;
import osmo.tester.optimizer.greedy.MultiGreedy;
import osmo.tester.unittests.testmodels.CalculatorModel;
import osmo.tester.unittests.testmodels.RandomValueModel4;
import osmo.tester.unittests.testmodels.VendingMachine;

import java.util.List;

import static org.junit.Assert.*;

/** @author Teemu Kanstren */
public class MultiGreedyTests {
  @Before
  public void initTest() {
    TestUtils.startOutputCapture();
  }

  @After
  public void resetAfter() {
    TestUtils.endOutputCapture();
  }

  @Test
  public void calculatorOptimization() throws Exception {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(1, 5, 0.2d));
    oc.setFactory(new MyModelFactory());
    oc.setTrackOptions(true);
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy multiGreedy = new MultiGreedy(oc, config, 111, 5);
    List<TestCase> tests = multiGreedy.search();
    assertEquals("Number of tests from MultiGreedy", 3, tests.size());
    assertEquals("MultiGreedy test1", "TestCase:[start, increase, decrease, increase, increase]", tests.get(0).toString());
    assertEquals("MultiGreedy test2", "TestCase:[start, increase, increase, decrease, decrease]", tests.get(1).toString());
    assertEquals("MultiGreedy test3", "TestCase:[start, increase, increase, increase, increase]", tests.get(2).toString());
    String report = TestUtils.readFile(multiGreedy.createFinalReportPath(), "UTF8");
    String expected = TestUtils.getResource(GreedyTests.class, "expected-multigreedy.txt");
    assertEquals("Multi-Greedy report", expected, report);
    }

  @Test
  public void maxLength() {
    OSMOConfiguration oc = new OSMOConfiguration();
    ScoreConfiguration sc = new ScoreConfiguration();
    oc.setFactory(new ReflectiveModelFactory(RandomValueModel4.class));
    oc.setTestEndCondition(new LengthProbability(5, 1d));
    MultiGreedy greedy = new MultiGreedy(oc, sc, 1);
    greedy.setMax(2);
    greedy.setTimeout(2);
    greedy.setThreshold(-1);
    List<TestCase> tests = greedy.search();
    assertEquals("Number of tests from greedy with max", 2, tests.size());
    //asserting the score might be useful as well to see it performs better. but would require better test model.
  }

  @Test
  public void iterationListener() {
    OSMOConfiguration oc = new OSMOConfiguration();
    ScoreConfiguration sc = new ScoreConfiguration();
    oc.setFactory(new ReflectiveModelFactory(RandomValueModel4.class));
    oc.setTestEndCondition(new LengthProbability(5, 1d));
    MultiGreedy greedy = new MultiGreedy(oc, sc, 1);
    greedy.setTimeout(2);
    greedy.setThreshold(-1);
    MyIterationListener listener = new MyIterationListener();
    greedy.addIterationListener(listener);
    List<TestCase> tests = greedy.search();
//    assertEquals("Number of iterations", 2, listener.count);
    assertEquals("Number of iterations", 1, listener.finished);
    assertEquals("Final tests", tests, listener.finalTests);
  }

  @Test
  public void deterministic1() {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(10, 20, 0.2d));
    oc.setFactory(models -> models.add(new VendingMachine()));
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy mg = new MultiGreedy(oc, config, 111, 1);
    mg.setPopulationSize(500);
    mg.setMaxIterations(5);
    List<TestCase> tests = mg.search();
    assertEquals("Number of generated tests", 293, tests.size());
    TestCoverage coverage = tests.get(0).getCoverage();
    assertEquals("Requirements coverage", "[10cents, 50cents, 20cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[10cents, 50cents, 20cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Orange Pepsi, Small Twinkie]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Orange Pepsi, Orange Pepsi->Small Twinkie]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 23, coverage.getValueCount());
    assertEquals("Step coverage", "{10cents=7, 50cents=6, 20cents=5, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->10cents, 10cents->50cents, 50cents->50cents, 50cents->10cents, 50cents->20cents, 20cents->10cents, 10cents->vend, vend->50cents, 10cents->10cents, 10cents->20cents, 20cents->50cents, 50cents->vend, vend->20cents, 20cents->20cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[10, 60, 110, 160, 170, 220, 240, 250, 105, 155, 175, 185, 195, 205, 215, 235, 285, 100, 120, 140], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = tests.get(287).getCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, vend, 10cents]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, vend, 10cents]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Turqoise Parsnip, Yellow Cat]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Turqoise Parsnip, Turqoise Parsnip->Yellow Cat]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 16, coverage.getTotalSteps());
    assertEquals("Variable value total count", 15, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=7, 20cents=4, vend=2, 10cents=3}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->20cents, 20cents->50cents, 50cents->vend, vend->20cents, 50cents->10cents, 10cents->20cents, 20cents->10cents, 10cents->10cents, 20cents->vend]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 170, 220, 270, 320, 230, 250, 260, 290, 60], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = mg.getFinalCoverage();
    assertEquals("Requirements coverage", "[10cents, 50cents, 20cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[10cents, 50cents, 20cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 210, coverage.getStateCount());
    assertEquals("State pair count", 429, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Orange Pepsi, Small Twinkie, Regular Wine, Red Pellegrino, Green Potato, Brown Turnip, Red Dog, White Chocolate bar, Spotted Orange Juice, Red Sheep, Red Wine, White Vichy, Brown Beer, Small Carrot, Yellow Banana, Brown Fanta, Big Fanta, Turqoise Daikon, Fluffy Banana, Spotted Pepper, Big Zombie, Green Mountain Dew, Green Piglet, Green Skeleton, Big Beer, Brown Perrier, Fluffy Fanta, Yellow Perrier, Small Piglet, Green Creeper, Blue Milkshake, Brown Gummy bears, Brown Cinnabon, White Mountain Dew, Brown Zombie, Blue Beer, Turqoise Sheep, Big Gummy bears, Orange Coke, Yellow Cinnabon, Blue Cucumber, Yellow Corn, White Piglet, Turqoise Wine, White Twinkie, Big Corn, Green Vichy, Orange Pigman, Green Doughnut, Big Banana, Purple Apple Juice, Red Pigman, Red Pepsi, Fluffy Cinnabon, Turqoise Pepper, Blue Cinnabon, Blue Banana, Pink Doughnut, Fluffy Zombie, Spotted Dog, Green Spite, Green Bell Pepper, Regular Coke, Brown Milkshake, Yellow Gummy bears, Green Apple Juice, Brown Milk, Big Perrier, Pink Chicken, Pink Bell Pepper, Regular Daikon, Blue Cat, Orange Dog, Turqoise Chocolate Milk, Small Vichy, Spotted Pigman, Pink Potato, Regular Orange Juice, Small Chocolate bar, Big Milkshake, Brown Horse, Small Potato, Spotted Parsnip, White Chicken, Orange Pellegrino, Small Chicken, Red Chocolate Milk, Purple Mountain Dew, Small Apple Juice, Regular Sheep, White Spite, White Carrot, Purple Chicken, Turqoise Pellegrino, Purple Potato, Pink Creeper, Turqoise Pigman, Orange Parsnip, Fluffy Cucumber, White Bell Pepper, Green Chicken, Spotted Coke, Fluffy Cat, Small Bell Pepper, Blue Turnip, Big Turnip, Green Chocolate bar, Yellow Beer, Yellow Horse, Brown Banana, Fluffy Horse, Purple Bell Pepper, Yellow Cat, Big Cinnabon, Turqoise Spider, Pink Spite, Spotted Daikon, Purple Piglet, Yellow Cucumber, Pink Chocolate bar, White Doughnut, White Potato, Orange Cookie, Big Milk, Spotted Cookie, Fluffy Corn, Orange Sheep, Red Orange Juice, Red Coke, Fluffy Gummy bears, Regular Chocolate Milk, Blue Milk, Brown Corn, Big Horse, Purple Vichy, Turqoise Orange Juice, Orange Daikon, Yellow Milkshake, Regular Pepper, Turqoise Dog, Small Spite, Regular Dog, Turqoise Cookie, Regular Spider, Regular Pellegrino, Small Mountain Dew, Purple Creeper, Regular Parsnip, Blue Zombie, Yellow Turnip, Spotted Pellegrino, Blue Fanta, Fluffy Perrier, Spotted Wine, Pink Apple Juice, Orange Pepper, Pink Skeleton, Turqoise Parsnip, Yellow Milk, Pink Carrot, Regular Cookie, Red Daikon, Purple Chocolate bar, Small Doughnut, Green Carrot, Purple Twinkie, Blue Gummy bears, Regular Pigman, Big Cucumber, Fluffy Milk, Blue Horse, Yellow Fanta, Orange Chocolate Milk, Red Spider, Orange Orange Juice, Fluffy Turnip, Small Skeleton, Spotted Chocolate Milk, Pink Twinkie, Brown Cat, Spotted Pepsi, White Apple Juice, Turqoise Pepsi, Spotted Spider, Regular Pepsi, Pink Piglet, White Skeleton, Yellow Zombie, Purple Doughnut, Pink Mountain Dew, Fluffy Milkshake, Purple Carrot, Red Parsnip, Small Creeper, White Creeper, Blue Corn, Red Cookie, Pink Vichy, Spotted Sheep, Purple Spite, Big Cat, Green Twinkie, Fluffy Beer, Red Pepper, Blue Perrier, Purple Skeleton, Brown Cucumber, Turqoise Coke, Orange Spider, Orange Wine]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Orange Pepsi, Orange Pepsi->Small Twinkie, osmo.tester.START_STATE->Regular Wine, Regular Wine->Red Pellegrino, osmo.tester.START_STATE->Green Potato, Green Potato->Brown Turnip, osmo.tester.START_STATE->Red Dog, Red Dog->White Chocolate bar, osmo.tester.START_STATE->Spotted Orange Juice, Spotted Orange Juice->Red Sheep, osmo.tester.START_STATE->Red Wine, Red Wine->White Vichy, osmo.tester.START_STATE->Brown Beer, Brown Beer->Small Carrot, osmo.tester.START_STATE->Yellow Banana, Yellow Banana->Brown Fanta, osmo.tester.START_STATE->Big Fanta, Big Fanta->Turqoise Daikon, osmo.tester.START_STATE->Fluffy Banana, Fluffy Banana->Spotted Pepper, osmo.tester.START_STATE->Big Zombie, Big Zombie->Green Mountain Dew, osmo.tester.START_STATE->Green Piglet, Green Piglet->Green Skeleton, osmo.tester.START_STATE->Big Beer, Big Beer->Brown Perrier, osmo.tester.START_STATE->Fluffy Fanta, Fluffy Fanta->Yellow Perrier, osmo.tester.START_STATE->Small Piglet, Small Piglet->Green Creeper, osmo.tester.START_STATE->Blue Milkshake, Blue Milkshake->Brown Gummy bears, osmo.tester.START_STATE->Brown Cinnabon, Brown Cinnabon->White Mountain Dew, osmo.tester.START_STATE->Brown Zombie, Brown Zombie->Blue Beer, osmo.tester.START_STATE->Turqoise Sheep, Turqoise Sheep->Big Gummy bears, osmo.tester.START_STATE->Orange Coke, Orange Coke->Yellow Cinnabon, osmo.tester.START_STATE->Blue Cucumber, Blue Cucumber->Yellow Corn, osmo.tester.START_STATE->White Piglet, White Piglet->Turqoise Wine, osmo.tester.START_STATE->White Twinkie, White Twinkie->Big Corn, osmo.tester.START_STATE->Green Vichy, Green Vichy->Orange Pigman, osmo.tester.START_STATE->Green Doughnut, Green Doughnut->Big Banana, osmo.tester.START_STATE->Purple Apple Juice, Purple Apple Juice->Red Pigman, osmo.tester.START_STATE->Red Pepsi, Red Pepsi->Fluffy Cinnabon, osmo.tester.START_STATE->Turqoise Pepper, Turqoise Pepper->Blue Cinnabon, osmo.tester.START_STATE->Blue Banana, Blue Banana->Pink Doughnut, osmo.tester.START_STATE->Fluffy Zombie, Fluffy Zombie->Spotted Dog, osmo.tester.START_STATE->Green Spite, Green Spite->Green Bell Pepper, osmo.tester.START_STATE->Regular Coke, Regular Coke->Brown Milkshake, osmo.tester.START_STATE->Yellow Gummy bears, Yellow Gummy bears->Green Apple Juice, osmo.tester.START_STATE->Brown Milk, Brown Milk->Big Perrier, osmo.tester.START_STATE->Pink Chicken, Pink Chicken->Pink Bell Pepper, osmo.tester.START_STATE->Regular Daikon, Regular Daikon->Blue Cat, osmo.tester.START_STATE->Orange Dog, Orange Dog->Turqoise Chocolate Milk, osmo.tester.START_STATE->Small Vichy, Small Vichy->Spotted Pigman, osmo.tester.START_STATE->Pink Potato, Pink Potato->Regular Orange Juice, osmo.tester.START_STATE->Small Chocolate bar, Small Chocolate bar->Big Milkshake, osmo.tester.START_STATE->Brown Horse, Brown Horse->Small Potato, osmo.tester.START_STATE->Spotted Parsnip, Spotted Parsnip->White Chicken, osmo.tester.START_STATE->Orange Pellegrino, Orange Pellegrino->Small Chicken, osmo.tester.START_STATE->Red Chocolate Milk, Red Chocolate Milk->Purple Mountain Dew, osmo.tester.START_STATE->Small Apple Juice, Small Apple Juice->Regular Sheep, osmo.tester.START_STATE->White Spite, White Spite->White Carrot, osmo.tester.START_STATE->Purple Chicken, Purple Chicken->Turqoise Pellegrino, osmo.tester.START_STATE->Purple Potato, Purple Potato->Pink Creeper, osmo.tester.START_STATE->Turqoise Pigman, Turqoise Pigman->Orange Parsnip, osmo.tester.START_STATE->Fluffy Cucumber, Fluffy Cucumber->White Bell Pepper, osmo.tester.START_STATE->Green Chicken, Green Chicken->Spotted Coke, osmo.tester.START_STATE->Fluffy Cat, Fluffy Cat->Small Bell Pepper, osmo.tester.START_STATE->Blue Turnip, Blue Turnip->Big Turnip, osmo.tester.START_STATE->Green Chocolate bar, Green Chocolate bar->Yellow Beer, osmo.tester.START_STATE->Yellow Horse, Yellow Horse->Brown Banana, osmo.tester.START_STATE->Fluffy Horse, Fluffy Horse->Purple Bell Pepper, osmo.tester.START_STATE->Yellow Cat, Yellow Cat->Big Cinnabon, osmo.tester.START_STATE->Turqoise Spider, Turqoise Spider->Pink Spite, osmo.tester.START_STATE->Spotted Daikon, Spotted Daikon->Purple Piglet, osmo.tester.START_STATE->Yellow Cucumber, Yellow Cucumber->Pink Chocolate bar, osmo.tester.START_STATE->White Doughnut, White Doughnut->White Potato, osmo.tester.START_STATE->Orange Cookie, Orange Cookie->Big Milk, osmo.tester.START_STATE->Spotted Cookie, Spotted Cookie->Fluffy Corn, osmo.tester.START_STATE->Orange Sheep, Orange Sheep->Red Orange Juice, osmo.tester.START_STATE->Red Coke, Red Coke->Fluffy Gummy bears, osmo.tester.START_STATE->Regular Chocolate Milk, Regular Chocolate Milk->Blue Milk, osmo.tester.START_STATE->Brown Corn, Brown Corn->Big Horse, osmo.tester.START_STATE->Purple Vichy, Purple Vichy->Turqoise Orange Juice, osmo.tester.START_STATE->Orange Daikon, Orange Daikon->Yellow Milkshake, osmo.tester.START_STATE->Regular Pepper, Regular Pepper->Turqoise Dog, osmo.tester.START_STATE->Small Spite, Small Spite->Regular Dog, osmo.tester.START_STATE->White Chocolate bar, White Chocolate bar->Turqoise Cookie, osmo.tester.START_STATE->Regular Spider, Regular Spider->Regular Wine, osmo.tester.START_STATE->Regular Pellegrino, Regular Pellegrino->Yellow Banana, osmo.tester.START_STATE->Small Mountain Dew, Small Mountain Dew->Big Gummy bears, osmo.tester.START_STATE->Purple Creeper, Purple Creeper->Green Potato, osmo.tester.START_STATE->Red Pellegrino, Red Pellegrino->Regular Parsnip, osmo.tester.START_STATE->Blue Zombie, Blue Zombie->Orange Pigman, osmo.tester.START_STATE->Yellow Turnip, Yellow Turnip->White Twinkie, osmo.tester.START_STATE->Spotted Pellegrino, Spotted Pellegrino->Green Apple Juice, osmo.tester.START_STATE->Big Milkshake, Big Milkshake->Blue Fanta, osmo.tester.START_STATE->Fluffy Perrier, Fluffy Perrier->White Piglet, osmo.tester.START_STATE->Spotted Wine, Spotted Wine->Turqoise Wine, osmo.tester.START_STATE->Pink Apple Juice, Pink Apple Juice->Brown Perrier, osmo.tester.START_STATE->Orange Pepper, Orange Pepper->Pink Doughnut, osmo.tester.START_STATE->Pink Skeleton, Pink Skeleton->Brown Turnip, osmo.tester.START_STATE->Brown Perrier, Brown Perrier->Turqoise Parsnip, osmo.tester.START_STATE->Yellow Corn, Yellow Corn->Yellow Milk, osmo.tester.START_STATE->Pink Carrot, Pink Carrot->Spotted Coke, osmo.tester.START_STATE->Regular Cookie, Regular Cookie->Regular Cookie, osmo.tester.START_STATE->Red Daikon, Red Daikon->Brown Zombie, osmo.tester.START_STATE->Big Corn, Big Corn->Purple Chocolate bar, osmo.tester.START_STATE->Small Doughnut, Small Doughnut->Purple Bell Pepper, osmo.tester.START_STATE->Green Carrot, Green Carrot->Red Chocolate Milk, osmo.tester.START_STATE->Purple Twinkie, Purple Twinkie->Red Coke, osmo.tester.START_STATE->Blue Gummy bears, Blue Gummy bears->Blue Milk, osmo.tester.START_STATE->Brown Turnip, Brown Turnip->Regular Pigman, osmo.tester.START_STATE->Big Cucumber, Big Cucumber->Yellow Beer, osmo.tester.START_STATE->Spotted Coke, Spotted Coke->Fluffy Milk, osmo.tester.START_STATE->Yellow Cinnabon, Yellow Cinnabon->Blue Horse, osmo.tester.START_STATE->Red Sheep, Red Sheep->Yellow Fanta, osmo.tester.START_STATE->Orange Chocolate Milk, Orange Chocolate Milk->Small Piglet, osmo.tester.START_STATE->Regular Dog, Regular Dog->Red Spider, osmo.tester.START_STATE->Orange Orange Juice, osmo.tester.START_STATE->Fluffy Turnip, osmo.tester.START_STATE->Small Skeleton, osmo.tester.START_STATE->Spotted Chocolate Milk, osmo.tester.START_STATE->Pink Twinkie, osmo.tester.START_STATE->Brown Cat, osmo.tester.START_STATE->Spotted Pepsi, osmo.tester.START_STATE->White Apple Juice, osmo.tester.START_STATE->Turqoise Pepsi, osmo.tester.START_STATE->Spotted Spider, osmo.tester.START_STATE->Regular Pepsi, osmo.tester.START_STATE->Pink Piglet, osmo.tester.START_STATE->White Skeleton, osmo.tester.START_STATE->Yellow Zombie, osmo.tester.START_STATE->Purple Doughnut, osmo.tester.START_STATE->Pink Mountain Dew, osmo.tester.START_STATE->Fluffy Milkshake, osmo.tester.START_STATE->Purple Carrot, osmo.tester.START_STATE->Red Parsnip, osmo.tester.START_STATE->Small Creeper, osmo.tester.START_STATE->White Creeper, osmo.tester.START_STATE->Blue Corn, osmo.tester.START_STATE->Red Cookie, osmo.tester.START_STATE->Pink Vichy, osmo.tester.START_STATE->Spotted Sheep, Green Potato->Purple Spite, osmo.tester.START_STATE->Big Cat, osmo.tester.START_STATE->Green Twinkie, osmo.tester.START_STATE->Fluffy Beer, osmo.tester.START_STATE->Red Pepper, osmo.tester.START_STATE->Blue Perrier, osmo.tester.START_STATE->Purple Skeleton, osmo.tester.START_STATE->Brown Cucumber, osmo.tester.START_STATE->Turqoise Coke, osmo.tester.START_STATE->Orange Spider, osmo.tester.START_STATE->Orange Wine, osmo.tester.START_STATE->Turqoise Wine, Turqoise Wine->Green Skeleton, osmo.tester.START_STATE->Purple Piglet, Purple Piglet->Purple Piglet, osmo.tester.START_STATE->Big Perrier, Big Perrier->Fluffy Cinnabon, osmo.tester.START_STATE->Orange Parsnip, Orange Parsnip->Small Carrot, osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Regular Sheep, osmo.tester.START_STATE->Yellow Milkshake, Yellow Milkshake->Turqoise Daikon, osmo.tester.START_STATE->Brown Fanta, Brown Fanta->Blue Cinnabon, osmo.tester.START_STATE->Spotted Pepper, Spotted Pepper->Small Spite, osmo.tester.START_STATE->Pink Chocolate bar, Pink Chocolate bar->Brown Milk, osmo.tester.START_STATE->Turqoise Dog, Turqoise Dog->Yellow Corn, osmo.tester.START_STATE->Big Cinnabon, Big Cinnabon->Regular Daikon, osmo.tester.START_STATE->Green Creeper, Green Creeper->Orange Pellegrino, osmo.tester.START_STATE->Regular Orange Juice, Regular Orange Juice->Turqoise Dog, osmo.tester.START_STATE->Purple Bell Pepper, Purple Bell Pepper->Big Corn, osmo.tester.START_STATE->Blue Cinnabon, Blue Cinnabon->Pink Chicken, osmo.tester.START_STATE->Turqoise Parsnip, Turqoise Parsnip->Small Apple Juice, osmo.tester.START_STATE->Green Mountain Dew, Green Mountain Dew->Big Banana, osmo.tester.START_STATE->Big Turnip, Big Turnip->Blue Milk, osmo.tester.START_STATE->Spotted Dog, Spotted Dog->Turqoise Wine, osmo.tester.START_STATE->Pink Bell Pepper, Pink Bell Pepper->Fluffy Zombie, osmo.tester.START_STATE->Blue Cat, Blue Cat->Orange Sheep, osmo.tester.START_STATE->Fluffy Corn, Fluffy Corn->Fluffy Corn, osmo.tester.START_STATE->Turqoise Pellegrino, Turqoise Pellegrino->Green Creeper, osmo.tester.START_STATE->Yellow Perrier, Yellow Perrier->Green Chicken, osmo.tester.START_STATE->White Vichy, White Vichy->Red Wine, osmo.tester.START_STATE->Pink Creeper, Pink Creeper->Small Spite, osmo.tester.START_STATE->Fluffy Cinnabon, Fluffy Cinnabon->Big Milk, osmo.tester.START_STATE->Small Chicken, Small Chicken->Small Bell Pepper, osmo.tester.START_STATE->Big Banana, Big Banana->Regular Daikon, osmo.tester.START_STATE->Spotted Pigman, Spotted Pigman->Red Daikon, osmo.tester.START_STATE->Small Carrot, Small Carrot->Pink Spite, osmo.tester.START_STATE->Yellow Beer, Yellow Beer->Green Doughnut, osmo.tester.START_STATE->Blue Milk, Blue Milk->White Vichy, osmo.tester.START_STATE->Purple Mountain Dew, osmo.tester.START_STATE->Turqoise Cookie, osmo.tester.START_STATE->White Chicken, osmo.tester.START_STATE->White Bell Pepper, osmo.tester.START_STATE->Blue Fanta, osmo.tester.START_STATE->Purple Chocolate bar, osmo.tester.START_STATE->Brown Milkshake, osmo.tester.START_STATE->Turqoise Orange Juice, osmo.tester.START_STATE->Orange Pigman, osmo.tester.START_STATE->Brown Banana, osmo.tester.START_STATE->Green Bell Pepper, Orange Pepsi->Small Apple Juice, osmo.tester.START_STATE->Fluffy Milk, Brown Turnip->Orange Dog, osmo.tester.START_STATE->Blue Horse, osmo.tester.START_STATE->Small Bell Pepper, osmo.tester.START_STATE->Pink Spite, osmo.tester.START_STATE->Blue Beer, osmo.tester.START_STATE->Regular Parsnip, osmo.tester.START_STATE->Turqoise Chocolate Milk, Regular Pepper->Red Dog, osmo.tester.START_STATE->Small Twinkie, osmo.tester.START_STATE->Big Horse, osmo.tester.START_STATE->Fluffy Gummy bears, osmo.tester.START_STATE->Red Pigman, osmo.tester.START_STATE->Yellow Fanta, Blue Milkshake->Red Daikon, osmo.tester.START_STATE->White Mountain Dew, Yellow Banana->Yellow Banana, Red Pepsi->Brown Zombie, osmo.tester.START_STATE->Turqoise Daikon, Brown Perrier->Spotted Pigman, osmo.tester.START_STATE->Yellow Milk, Fluffy Zombie->Pink Skeleton, osmo.tester.START_STATE->Green Apple Juice, osmo.tester.START_STATE->Pink Doughnut, Regular Wine->Turqoise Dog, Turqoise Pepper->Blue Cucumber, osmo.tester.START_STATE->Green Skeleton, osmo.tester.START_STATE->Purple Spite, osmo.tester.START_STATE->Red Orange Juice, Brown Milk->Pink Spite, Regular Chocolate Milk->Blue Cinnabon, Small Piglet->White Doughnut, osmo.tester.START_STATE->Big Gummy bears, Turqoise Wine->Orange Pigman, Orange Pepsi->Fluffy Cinnabon, osmo.tester.START_STATE->Small Potato, osmo.tester.START_STATE->Brown Gummy bears, osmo.tester.START_STATE->Regular Pigman, Regular Coke->Turqoise Pellegrino, Yellow Gummy bears->Green Piglet, Green Doughnut->Turqoise Pellegrino, osmo.tester.START_STATE->White Potato, osmo.tester.START_STATE->White Carrot, osmo.tester.START_STATE->Red Spider, Pink Potato->Brown Zombie, Blue Milkshake->Purple Bell Pepper, Orange Parsnip->Red Pellegrino, Red Sheep->Yellow Cucumber, Orange Dog->Green Vichy, Orange Coke->White Carrot, Purple Apple Juice->Turqoise Parsnip, Blue Turnip->White Chicken, Spotted Pellegrino->Fluffy Cinnabon, Green Creeper->Green Apple Juice, Brown Cinnabon->Green Potato, Red Dog->Red Dog, Yellow Gummy bears->Purple Twinkie, Pink Chocolate bar->Big Banana, Brown Zombie->Yellow Gummy bears, Big Fanta->Regular Pigman, Small Mountain Dew->Small Chicken, Yellow Corn->Purple Piglet, Orange Pepsi->Turqoise Spider, Red Pepsi->Brown Cat, osmo.tester.START_STATE->Big Milk, Orange Pellegrino->Turqoise Coke, Purple Apple Juice->Big Milk, Pink Potato->Fluffy Cucumber, Turqoise Dog->Small Carrot, Turqoise Pigman->Brown Cinnabon, Brown Perrier->Brown Banana, Blue Cinnabon->Turqoise Spider, Green Potato->Fluffy Milk, Blue Cinnabon->Yellow Banana, Orange Dog->Spotted Pigman, Red Chocolate Milk->Green Carrot, Purple Chicken->Green Vichy, Brown Beer->Green Creeper, Red Wine->White Skeleton, Blue Cat->Small Apple Juice, White Twinkie->Blue Cinnabon, Green Vichy->Green Skeleton, Purple Potato->Fluffy Corn, Red Chocolate Milk->Yellow Milkshake, Spotted Cookie->Regular Cookie, Big Beer->Orange Chocolate Milk, Regular Spider->Big Corn, Purple Potato->Green Potato, Yellow Corn->Brown Beer, Regular Cookie->Green Doughnut, Purple Potato->Orange Orange Juice, Small Mountain Dew->Purple Potato, Big Milkshake->Green Bell Pepper, Spotted Pepper->Turqoise Chocolate Milk, Brown Horse->Spotted Wine, Brown Cinnabon->Brown Cat, Red Wine->Red Wine, Fluffy Banana->Big Corn, Purple Vichy->Orange Pigman, Small Doughnut->Small Doughnut, Small Carrot->Blue Zombie, Purple Twinkie->Green Bell Pepper, White Doughnut->Yellow Zombie, Turqoise Parsnip->Yellow Cat, Blue Turnip->Yellow Gummy bears, Fluffy Corn->Orange Coke, Small Chocolate bar->White Chicken, Brown Cinnabon->Turqoise Dog, White Chocolate bar->Green Vichy]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 5274, coverage.getTotalSteps());
    assertEquals("Variable value total count", 73, coverage.getValueCount());
    assertEquals("Step coverage", "{10cents=1317, 50cents=1967, 20cents=1478, vend=512}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->10cents, 10cents->50cents, 50cents->50cents, 50cents->10cents, 50cents->20cents, 20cents->10cents, 10cents->vend, vend->50cents, 10cents->10cents, 10cents->20cents, 20cents->50cents, 50cents->vend, vend->20cents, 20cents->20cents, .osmo.tester.start.step->20cents, 20cents->vend, vend->10cents, .osmo.tester.start.step->50cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[10, 60, 110, 160, 170, 220, 240, 250, 105, 155, 175, 185, 195, 205, 215, 235, 285, 100, 120, 140, 20, 70, 190, 260, 310, 75, 95, 145, 165, 225, 245, 265, 30, 40, 50, 200, 270, 320, 130, 150, 180, 230, 280, 65, 115, 135, 80, 210, 290, 300, 255, 315, 85, 90, 275, 295, 305, 125, 340, 25, 45, 55, 330, 15, 35, 345, 335, 5, 325, 0], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());
  }

  @Test
  public void deterministic() {
    OSMOConfiguration oc = new OSMOConfiguration();
    oc.setTestEndCondition(new LengthProbability(10, 20, 0.2d));
    oc.setFactory(models -> models.add(new VendingMachine()));
    ScoreConfiguration config = new ScoreConfiguration();
    config.setLengthWeight(0);
    MultiGreedy mg = new MultiGreedy(oc, config, 111, 2);
    mg.setPopulationSize(500);
    mg.setMaxIterations(5);
    List<TestCase> tests = mg.search();
    assertEquals("Number of generated tests", 459, tests.size());
    TestCoverage coverage = tests.get(0).getCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, vend, 10cents]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, vend, 10cents]", coverage.getSingles().toString());
    assertEquals("State count", 3, coverage.getStateCount());
    assertEquals("State pair count", 3, coverage.getStatePairCount());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 24, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=10, 20cents=4, vend=3, 10cents=3}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->20cents, 20cents->50cents, 50cents->vend, vend->50cents, 20cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->vend, 50cents->10cents, 10cents->50cents, 10cents->vend]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 200, 250, 270, 320, 160, 210, 230, 240, 260, 280, 135, 185, 195, 245, 295, 305, 120], bottles=[10, 9, 8, 7]}", coverage.getVariableValues().toString());

    coverage = tests.get(287).getCoverage();
    assertEquals("Requirements coverage", "[20cents, 50cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[20cents, 50cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Purple Apple Juice, Turqoise Parsnip]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Purple Apple Juice, Purple Apple Juice->Turqoise Parsnip]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 21, coverage.getValueCount());
    assertEquals("Step coverage", "{20cents=7, 50cents=8, 10cents=3, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->20cents, 20cents->50cents, 50cents->10cents, 10cents->50cents, 10cents->10cents, 50cents->50cents, 50cents->20cents, 20cents->20cents, 20cents->vend, vend->20cents, 50cents->vend, vend->50cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[20, 70, 80, 130, 140, 150, 200, 250, 270, 290, 310, 115, 135, 155, 205, 255, 10, 60], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = tests.get(439).getCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, 10cents, vend]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, 10cents, vend]", coverage.getSingles().toString());
    assertEquals("State count", 2, coverage.getStateCount());
    assertEquals("State pair count", 2, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[White Vichy, Purple Chocolate bar]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->White Vichy, White Vichy->Purple Chocolate bar]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 20, coverage.getTotalSteps());
    assertEquals("Variable value total count", 17, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=9, 20cents=6, 10cents=3, vend=2}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->20cents, 20cents->20cents, 20cents->10cents, 10cents->10cents, 10cents->50cents, 20cents->50cents, 50cents->vend, vend->20cents, vend->50cents, 50cents->10cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 170, 190, 200, 210, 260, 280, 330, 120, 10, 60, 70], bottles=[10, 9, 8]}", coverage.getVariableValues().toString());

    coverage = mg.getFinalCoverage();
    assertEquals("Requirements coverage", "[50cents, 20cents, vend, 10cents]", coverage.getRequirements().toString());
    assertEquals("Singles coverage", "[50cents, 20cents, vend, 10cents]", coverage.getSingles().toString());
    assertEquals("State count", 210, coverage.getStateCount());
    assertEquals("State pair count", 638, coverage.getStatePairCount());
    assertEquals("State coverage", "{item=[Purple Doughnut, Turqoise Pellegrino, Yellow Cinnabon, Big Cucumber, Regular Wine, Spotted Wine, Big Milk, Big Fanta, Brown Beer, Small Carrot, Green Doughnut, Big Banana, Purple Piglet, Fluffy Zombie, Pink Potato, Fluffy Cucumber, Small Doughnut, Brown Cucumber, Regular Chocolate Milk, Blue Cinnabon, Red Pellegrino, Regular Parsnip, Big Beer, Brown Perrier, Yellow Horse, Regular Pellegrino, White Twinkie, White Chicken, White Doughnut, Small Skeleton, Orange Orange Juice, Green Chocolate bar, Fluffy Fanta, Yellow Perrier, Orange Pepsi, Small Apple Juice, Small Vichy, Purple Potato, Small Piglet, Green Creeper, Blue Milkshake, Brown Gummy bears, Brown Cinnabon, White Mountain Dew, Brown Turnip, Orange Dog, Brown Zombie, Blue Beer, Turqoise Wine, Green Skeleton, Turqoise Sheep, Big Gummy bears, Turqoise Pigman, Spotted Coke, White Chocolate bar, Turqoise Cookie, Blue Cucumber, Yellow Corn, Fluffy Turnip, Spotted Pepsi, Regular Pepper, Red Dog, Green Vichy, Orange Pigman, Pink Carrot, Red Pepper, White Spite, Regular Dog, Yellow Banana, Turqoise Pepper, Turqoise Parsnip, Small Creeper, Purple Apple Juice, Red Pigman, Red Pepsi, Fluffy Cinnabon, Green Potato, Purple Spite, Blue Zombie, Small Twinkie, Blue Banana, Pink Doughnut, Big Perrier, Brown Milkshake, Spotted Pigman, Red Coke, Fluffy Milk, Blue Gummy bears, Green Spite, Green Bell Pepper, Yellow Cat, Regular Coke, Blue Horse, Purple Carrot, Spotted Spider, Pink Spite, Red Orange Juice, Yellow Beer, Orange Pellegrino, Regular Sheep, Spotted Dog, Yellow Milk, Brown Corn, Orange Sheep, Yellow Gummy bears, Green Apple Juice, Red Wine, White Vichy, Pink Chicken, Pink Bell Pepper, Fluffy Banana, Spotted Pepper, Small Spite, Purple Vichy, Spotted Orange Juice, Red Spider, Yellow Cucumber, Brown Cat, Small Potato, Red Sheep, Big Zombie, Green Mountain Dew, Regular Daikon, Blue Cat, Red Parsnip, Spotted Cookie, Orange Coke, Orange Parsnip, Pink Mountain Dew, Turqoise Coke, Small Chocolate bar, Big Milkshake, Spotted Parsnip, Spotted Daikon, Orange Cookie, Turqoise Pepsi, Blue Milk, Yellow Milkshake, Red Chocolate Milk, Purple Mountain Dew, Purple Chicken, Fluffy Beer, Pink Chocolate bar, Brown Milk, Orange Daikon, Orange Wine, Turqoise Spider, Pink Apple Juice, Fluffy Perrier, White Piglet, Fluffy Cat, Small Bell Pepper, Regular Orange Juice, Turqoise Dog, Blue Turnip, Big Turnip, Purple Bell Pepper, Big Corn, Brown Fanta, White Potato, Small Mountain Dew, Small Chicken, Big Cat, Pink Vichy, Pink Creeper, Pink Skeleton, Big Cinnabon, Fluffy Milkshake, Blue Perrier, Pink Piglet, Green Piglet, Green Twinkie, White Carrot, Regular Spider, Spotted Chocolate Milk, Turqoise Daikon, Orange Chocolate Milk, Brown Banana, Turqoise Chocolate Milk, Purple Creeper, Brown Horse, Spotted Pellegrino, Yellow Turnip, Yellow Fanta, Blue Fanta, White Bell Pepper, White Skeleton, Green Chicken, Orange Pepper, Yellow Zombie, Pink Twinkie, Big Horse, Fluffy Horse, Regular Cookie, Regular Pigman, Red Daikon, Purple Chocolate bar, Fluffy Corn, Green Carrot, White Creeper, Fluffy Gummy bears, Purple Twinkie, Turqoise Orange Juice, Regular Pepsi, White Apple Juice, Red Cookie, Spotted Sheep, Blue Corn, Orange Spider, Purple Skeleton]}", coverage.getStates().toString());
    assertEquals("State pair coverage", "{item-pair=[osmo.tester.START_STATE->Purple Doughnut, Purple Doughnut->Turqoise Pellegrino, Turqoise Pellegrino->Yellow Cinnabon, osmo.tester.START_STATE->Big Cucumber, Big Cucumber->Regular Wine, Regular Wine->Spotted Wine, osmo.tester.START_STATE->Big Milk, Big Milk->Big Fanta, osmo.tester.START_STATE->Brown Beer, Brown Beer->Small Carrot, osmo.tester.START_STATE->Green Doughnut, Green Doughnut->Big Banana, osmo.tester.START_STATE->Purple Piglet, Purple Piglet->Fluffy Zombie, osmo.tester.START_STATE->Pink Potato, Pink Potato->Fluffy Cucumber, osmo.tester.START_STATE->Small Doughnut, Small Doughnut->Brown Cucumber, osmo.tester.START_STATE->Regular Chocolate Milk, Regular Chocolate Milk->Blue Cinnabon, osmo.tester.START_STATE->Red Pellegrino, Red Pellegrino->Regular Parsnip, osmo.tester.START_STATE->Big Beer, Big Beer->Brown Perrier, osmo.tester.START_STATE->Yellow Horse, Yellow Horse->Regular Pellegrino, osmo.tester.START_STATE->White Twinkie, White Twinkie->White Chicken, osmo.tester.START_STATE->White Doughnut, White Doughnut->Small Skeleton, osmo.tester.START_STATE->Orange Orange Juice, Orange Orange Juice->Green Chocolate bar, osmo.tester.START_STATE->Fluffy Fanta, Fluffy Fanta->Yellow Perrier, osmo.tester.START_STATE->Orange Pepsi, Orange Pepsi->Small Apple Juice, osmo.tester.START_STATE->Small Vichy, Small Vichy->Purple Potato, osmo.tester.START_STATE->Small Piglet, Small Piglet->Green Creeper, osmo.tester.START_STATE->Blue Milkshake, Blue Milkshake->Brown Gummy bears, osmo.tester.START_STATE->Brown Cinnabon, Brown Cinnabon->White Mountain Dew, osmo.tester.START_STATE->Brown Turnip, Brown Turnip->Orange Dog, osmo.tester.START_STATE->Brown Zombie, Brown Zombie->Blue Beer, osmo.tester.START_STATE->Turqoise Wine, Turqoise Wine->Green Skeleton, osmo.tester.START_STATE->Turqoise Sheep, Turqoise Sheep->Big Gummy bears, osmo.tester.START_STATE->Turqoise Pigman, Turqoise Pigman->Spotted Coke, osmo.tester.START_STATE->White Chocolate bar, White Chocolate bar->Turqoise Cookie, osmo.tester.START_STATE->Blue Cucumber, Blue Cucumber->Yellow Corn, osmo.tester.START_STATE->Fluffy Turnip, Fluffy Turnip->Spotted Pepsi, osmo.tester.START_STATE->Regular Pepper, Regular Pepper->Red Dog, osmo.tester.START_STATE->Green Vichy, Green Vichy->Orange Pigman, osmo.tester.START_STATE->Pink Carrot, Pink Carrot->Red Pepper, osmo.tester.START_STATE->White Spite, White Spite->Regular Dog, osmo.tester.START_STATE->Yellow Banana, Yellow Banana->Turqoise Pepper, osmo.tester.START_STATE->Turqoise Parsnip, Turqoise Parsnip->Small Creeper, osmo.tester.START_STATE->Purple Apple Juice, Purple Apple Juice->Red Pigman, osmo.tester.START_STATE->Red Pepsi, Red Pepsi->Fluffy Cinnabon, osmo.tester.START_STATE->Green Potato, Green Potato->Purple Spite, osmo.tester.START_STATE->Blue Zombie, Blue Zombie->Small Twinkie, osmo.tester.START_STATE->Blue Banana, Blue Banana->Pink Doughnut, osmo.tester.START_STATE->Big Perrier, Big Perrier->Brown Milkshake, osmo.tester.START_STATE->Spotted Pigman, Spotted Pigman->Red Coke, osmo.tester.START_STATE->Fluffy Milk, Fluffy Milk->Blue Gummy bears, osmo.tester.START_STATE->Green Spite, Green Spite->Green Bell Pepper, osmo.tester.START_STATE->Yellow Cat, Yellow Cat->Regular Coke, osmo.tester.START_STATE->Blue Horse, Blue Horse->Purple Carrot, osmo.tester.START_STATE->Spotted Spider, Spotted Spider->Pink Spite, osmo.tester.START_STATE->Red Orange Juice, Red Orange Juice->Yellow Beer, osmo.tester.START_STATE->Orange Pellegrino, Orange Pellegrino->Regular Sheep, osmo.tester.START_STATE->Spotted Dog, Spotted Dog->Yellow Milk, osmo.tester.START_STATE->Brown Corn, Brown Corn->Orange Sheep, osmo.tester.START_STATE->Yellow Gummy bears, Yellow Gummy bears->Green Apple Juice, osmo.tester.START_STATE->Red Wine, Red Wine->White Vichy, osmo.tester.START_STATE->Pink Chicken, Pink Chicken->Pink Bell Pepper, osmo.tester.START_STATE->Fluffy Banana, Fluffy Banana->Spotted Pepper, osmo.tester.START_STATE->Small Spite, Small Spite->Purple Vichy, osmo.tester.START_STATE->Spotted Orange Juice, Spotted Orange Juice->Red Spider, osmo.tester.START_STATE->Yellow Cucumber, Yellow Cucumber->Brown Cat, osmo.tester.START_STATE->Small Potato, Small Potato->Red Sheep, osmo.tester.START_STATE->Big Zombie, Big Zombie->Green Mountain Dew, osmo.tester.START_STATE->Regular Daikon, Regular Daikon->Blue Cat, osmo.tester.START_STATE->Red Parsnip, Red Parsnip->Spotted Cookie, osmo.tester.START_STATE->Orange Coke, Orange Coke->Orange Parsnip, osmo.tester.START_STATE->Pink Mountain Dew, Pink Mountain Dew->Turqoise Coke, osmo.tester.START_STATE->Small Chocolate bar, Small Chocolate bar->Big Milkshake, osmo.tester.START_STATE->Spotted Parsnip, Spotted Parsnip->Spotted Daikon, osmo.tester.START_STATE->Orange Cookie, Orange Cookie->Turqoise Pepsi, osmo.tester.START_STATE->Blue Milk, Blue Milk->Yellow Milkshake, osmo.tester.START_STATE->Red Chocolate Milk, Red Chocolate Milk->Purple Mountain Dew, osmo.tester.START_STATE->Purple Chicken, Purple Chicken->Fluffy Beer, osmo.tester.START_STATE->Pink Chocolate bar, Pink Chocolate bar->Brown Milk, osmo.tester.START_STATE->Orange Daikon, Orange Daikon->Orange Wine, osmo.tester.START_STATE->Turqoise Spider, Turqoise Spider->Pink Apple Juice, osmo.tester.START_STATE->Fluffy Perrier, Fluffy Perrier->White Piglet, osmo.tester.START_STATE->Fluffy Cat, Fluffy Cat->Small Bell Pepper, osmo.tester.START_STATE->Regular Orange Juice, Regular Orange Juice->Turqoise Dog, osmo.tester.START_STATE->Blue Turnip, Blue Turnip->Big Turnip, osmo.tester.START_STATE->Purple Bell Pepper, Purple Bell Pepper->Big Corn, osmo.tester.START_STATE->Brown Fanta, Brown Fanta->White Potato, osmo.tester.START_STATE->Small Mountain Dew, Small Mountain Dew->Small Chicken, osmo.tester.START_STATE->Big Cat, Big Cat->Pink Vichy, osmo.tester.START_STATE->Pink Creeper, Pink Creeper->Pink Skeleton, osmo.tester.START_STATE->Big Cinnabon, Big Cinnabon->Fluffy Milkshake, osmo.tester.START_STATE->Blue Perrier, Blue Perrier->Pink Piglet, osmo.tester.START_STATE->Green Piglet, Green Piglet->Green Twinkie, osmo.tester.START_STATE->Yellow Perrier, Yellow Perrier->White Carrot, osmo.tester.START_STATE->Regular Spider, Regular Spider->Regular Wine, osmo.tester.START_STATE->Spotted Chocolate Milk, Spotted Chocolate Milk->Yellow Cat, osmo.tester.START_STATE->Big Fanta, Big Fanta->Turqoise Daikon, osmo.tester.START_STATE->Orange Chocolate Milk, Orange Chocolate Milk->Turqoise Sheep, osmo.tester.START_STATE->Brown Banana, Brown Banana->Regular Pellegrino, osmo.tester.START_STATE->Orange Dog, Orange Dog->Turqoise Chocolate Milk, osmo.tester.START_STATE->Purple Creeper, Purple Creeper->Green Potato, osmo.tester.START_STATE->Brown Horse, Brown Horse->Small Potato, osmo.tester.START_STATE->Spotted Pellegrino, Spotted Pellegrino->Red Pepsi, osmo.tester.START_STATE->Yellow Turnip, Yellow Turnip->White Twinkie, osmo.tester.START_STATE->Brown Perrier, Brown Perrier->Yellow Fanta, osmo.tester.START_STATE->Big Milkshake, Big Milkshake->Blue Fanta, osmo.tester.START_STATE->Fluffy Cucumber, Fluffy Cucumber->White Bell Pepper, osmo.tester.START_STATE->White Skeleton, White Skeleton->Blue Horse, osmo.tester.START_STATE->Green Chicken, Green Chicken->Spotted Coke, osmo.tester.START_STATE->Orange Pepper, Orange Pepper->Pink Doughnut, osmo.tester.START_STATE->White Mountain Dew, White Mountain Dew->Yellow Zombie, osmo.tester.START_STATE->Pink Twinkie, Pink Twinkie->Red Pepsi, osmo.tester.START_STATE->Big Horse, Big Horse->Orange Daikon, osmo.tester.START_STATE->Fluffy Horse, Fluffy Horse->Purple Bell Pepper, osmo.tester.START_STATE->Regular Cookie, Regular Cookie->Regular Cookie, osmo.tester.START_STATE->Regular Dog, Regular Dog->Regular Pigman, osmo.tester.START_STATE->Red Daikon, Red Daikon->Brown Zombie, osmo.tester.START_STATE->Big Corn, Big Corn->Purple Chocolate bar, osmo.tester.START_STATE->Spotted Cookie, Spotted Cookie->Fluffy Corn, osmo.tester.START_STATE->Green Carrot, Green Carrot->Red Chocolate Milk, osmo.tester.START_STATE->White Creeper, White Creeper->Fluffy Milk, osmo.tester.START_STATE->Red Coke, Red Coke->Fluffy Gummy bears, osmo.tester.START_STATE->Purple Twinkie, Purple Twinkie->Red Coke, osmo.tester.START_STATE->Purple Vichy, Purple Vichy->Turqoise Orange Juice, osmo.tester.START_STATE->Regular Pepsi, Regular Pepsi->Small Twinkie, osmo.tester.START_STATE->White Apple Juice, osmo.tester.START_STATE->Red Cookie, osmo.tester.START_STATE->Spotted Sheep, osmo.tester.START_STATE->Blue Corn, osmo.tester.START_STATE->Orange Spider, osmo.tester.START_STATE->Purple Skeleton, osmo.tester.START_STATE->Pink Doughnut, Pink Doughnut->Blue Cinnabon, osmo.tester.START_STATE->Small Twinkie, Small Twinkie->Small Twinkie, osmo.tester.START_STATE->White Piglet, White Piglet->Turqoise Wine, osmo.tester.START_STATE->Turqoise Pepper, Turqoise Pepper->Blue Cinnabon, osmo.tester.START_STATE->Orange Parsnip, Orange Parsnip->Small Carrot, osmo.tester.START_STATE->Regular Pellegrino, Regular Pellegrino->Yellow Banana, osmo.tester.START_STATE->Fluffy Zombie, Fluffy Zombie->Spotted Dog, osmo.tester.START_STATE->Regular Coke, Regular Coke->Regular Daikon, osmo.tester.START_STATE->Regular Wine, Regular Wine->Turqoise Dog, osmo.tester.START_STATE->Turqoise Dog, Turqoise Dog->Brown Perrier, osmo.tester.START_STATE->Brown Milk, Brown Milk->Big Perrier, osmo.tester.START_STATE->Purple Spite, Purple Spite->Brown Turnip, osmo.tester.START_STATE->Regular Sheep, Regular Sheep->Regular Sheep, osmo.tester.START_STATE->Spotted Daikon, Spotted Daikon->Spotted Pigman, osmo.tester.START_STATE->Purple Carrot, Purple Carrot->Yellow Cat, osmo.tester.START_STATE->Yellow Milkshake, Yellow Milkshake->Turqoise Daikon, osmo.tester.START_STATE->Small Apple Juice, Small Apple Juice->Regular Sheep, osmo.tester.START_STATE->Orange Sheep, Orange Sheep->Orange Sheep, osmo.tester.START_STATE->Spotted Pepper, Spotted Pepper->Small Spite, osmo.tester.START_STATE->White Vichy, White Vichy->Big Milkshake, osmo.tester.START_STATE->Green Creeper, Green Creeper->Blue Cat, osmo.tester.START_STATE->Blue Cinnabon, Blue Cinnabon->Fluffy Beer, osmo.tester.START_STATE->Turqoise Pellegrino, Turqoise Pellegrino->Yellow Gummy bears, osmo.tester.START_STATE->Red Sheep, Red Sheep->Yellow Cucumber, osmo.tester.START_STATE->Purple Potato, Purple Potato->Pink Creeper, osmo.tester.START_STATE->Turqoise Coke, Turqoise Coke->Red Pellegrino, osmo.tester.START_STATE->Red Dog, Red Dog->White Chocolate bar, osmo.tester.START_STATE->White Chicken, White Chicken->Red Orange Juice, osmo.tester.START_STATE->Turqoise Cookie, Turqoise Cookie->Small Skeleton, osmo.tester.START_STATE->Spotted Wine, Spotted Wine->Turqoise Wine, osmo.tester.START_STATE->Pink Apple Juice, Pink Apple Juice->Brown Perrier, osmo.tester.START_STATE->Yellow Corn, Yellow Corn->Small Chicken, osmo.tester.START_STATE->Spotted Pepsi, Spotted Pepsi->Orange Pellegrino, osmo.tester.START_STATE->Pink Spite, Pink Spite->Spotted Pepsi, osmo.tester.START_STATE->Pink Skeleton, Pink Skeleton->Turqoise Coke, osmo.tester.START_STATE->Green Chocolate bar, Green Chocolate bar->Yellow Beer, osmo.tester.START_STATE->Orange Pigman, Orange Pigman->Brown Cinnabon, osmo.tester.START_STATE->Red Spider, Red Spider->Pink Apple Juice, osmo.tester.START_STATE->White Potato, White Potato->Yellow Cat, osmo.tester.START_STATE->Big Turnip, Big Turnip->Yellow Cucumber, osmo.tester.START_STATE->Pink Vichy, Pink Vichy->Orange Chocolate Milk, osmo.tester.START_STATE->Brown Milkshake, Brown Milkshake->Big Zombie, osmo.tester.START_STATE->Regular Parsnip, Regular Parsnip->Red Wine, osmo.tester.START_STATE->Regular Pigman, Regular Pigman->Turqoise Sheep, osmo.tester.START_STATE->Green Mountain Dew, Green Mountain Dew->Big Banana, osmo.tester.START_STATE->Pink Bell Pepper, Pink Bell Pepper->Fluffy Zombie, osmo.tester.START_STATE->Blue Cat, Blue Cat->Orange Sheep, osmo.tester.START_STATE->Fluffy Corn, Fluffy Corn->Fluffy Corn, osmo.tester.START_STATE->Red Pepper, Red Pepper->Big Perrier, osmo.tester.START_STATE->Small Carrot, Small Carrot->Fluffy Cucumber, osmo.tester.START_STATE->Blue Beer, Blue Beer->Big Milkshake, osmo.tester.START_STATE->Blue Gummy bears, Blue Gummy bears->Blue Milk, osmo.tester.START_STATE->Fluffy Cinnabon, Fluffy Cinnabon->Big Milk, osmo.tester.START_STATE->Small Chicken, Small Chicken->Small Bell Pepper, osmo.tester.START_STATE->Big Banana, Big Banana->Regular Daikon, osmo.tester.START_STATE->Spotted Coke, Spotted Coke->Fluffy Milk, osmo.tester.START_STATE->Yellow Cinnabon, Yellow Cinnabon->Blue Horse, osmo.tester.START_STATE->Brown Cucumber, Brown Cucumber->Big Milkshake, osmo.tester.START_STATE->Yellow Beer, Yellow Beer->Green Doughnut, osmo.tester.START_STATE->Yellow Fanta, Yellow Fanta->Big Cucumber, osmo.tester.START_STATE->Yellow Milk, osmo.tester.START_STATE->Turqoise Orange Juice, osmo.tester.START_STATE->Purple Mountain Dew, osmo.tester.START_STATE->Small Skeleton, osmo.tester.START_STATE->Small Creeper, Purple Piglet->Brown Horse, osmo.tester.START_STATE->Turqoise Chocolate Milk, osmo.tester.START_STATE->White Bell Pepper, osmo.tester.START_STATE->Blue Fanta, osmo.tester.START_STATE->Yellow Zombie, osmo.tester.START_STATE->Purple Chocolate bar, osmo.tester.START_STATE->White Carrot, osmo.tester.START_STATE->Brown Cat, osmo.tester.START_STATE->Fluffy Beer, osmo.tester.START_STATE->Turqoise Pepsi, osmo.tester.START_STATE->Green Twinkie, osmo.tester.START_STATE->Green Bell Pepper, Pink Creeper->White Doughnut, Big Beer->Fluffy Gummy bears, osmo.tester.START_STATE->Pink Piglet, osmo.tester.START_STATE->Fluffy Milkshake, Purple Piglet->Purple Piglet, Big Fanta->Red Coke, osmo.tester.START_STATE->Small Bell Pepper, osmo.tester.START_STATE->Red Pigman, Big Fanta->Turqoise Dog, Orange Coke->Green Doughnut, Orange Coke->Yellow Cinnabon, osmo.tester.START_STATE->Brown Gummy bears, osmo.tester.START_STATE->Fluffy Gummy bears, White Twinkie->Big Corn, Blue Milkshake->Red Daikon, Yellow Banana->Yellow Banana, osmo.tester.START_STATE->Green Apple Juice, Red Pepsi->Brown Zombie, osmo.tester.START_STATE->Turqoise Daikon, Big Perrier->Fluffy Cinnabon, Blue Milkshake->Regular Sheep, Fluffy Zombie->Green Vichy, Brown Perrier->Spotted Pigman, Purple Piglet->Pink Piglet, Fluffy Zombie->Pink Skeleton, osmo.tester.START_STATE->Big Gummy bears, Turqoise Pepper->Blue Cucumber, Regular Coke->Brown Milkshake, osmo.tester.START_STATE->Green Skeleton, Yellow Cucumber->Blue Milkshake, osmo.tester.START_STATE->Orange Wine, Small Mountain Dew->Big Gummy bears, Brown Milk->Pink Spite, Big Zombie->Purple Spite, Small Piglet->Blue Zombie, Small Piglet->White Doughnut, Orange Pepsi->Small Twinkie, Turqoise Wine->Orange Pigman, Pink Mountain Dew->Brown Corn, Purple Doughnut->Yellow Perrier, White Piglet->Big Milk, Orange Pepsi->Fluffy Cinnabon, Big Beer->Spotted Pepsi, White Mountain Dew->Yellow Milkshake, Fluffy Perrier->Green Potato, Purple Piglet->White Apple Juice, Red Chocolate Milk->Regular Chocolate Milk, Regular Coke->Turqoise Pellegrino, Yellow Gummy bears->Green Piglet, Green Doughnut->Turqoise Pellegrino, Orange Dog->Brown Cucumber, Small Vichy->Spotted Pigman, Pink Potato->Regular Orange Juice, Small Twinkie->Red Parsnip, Brown Beer->Regular Sheep, White Mountain Dew->Purple Chicken, Yellow Gummy bears->Small Spite, Blue Zombie->Orange Pigman, Turqoise Parsnip->Yellow Horse, Spotted Parsnip->White Chicken, Orange Pellegrino->Small Chicken, Pink Doughnut->Turqoise Sheep, White Spite->White Carrot, Yellow Cucumber->Red Cookie, Purple Apple Juice->Green Piglet, Big Corn->Big Zombie, Pink Potato->Brown Zombie, Purple Chicken->Turqoise Pellegrino, Brown Fanta->Blue Cinnabon, Spotted Parsnip->White Mountain Dew, Blue Milkshake->Purple Bell Pepper, Small Vichy->Pink Spite, Orange Cookie->White Bell Pepper, Spotted Pellegrino->Blue Cat, Turqoise Dog->Yellow Corn, Spotted Orange Juice->Red Sheep, Orange Parsnip->Red Pellegrino, Red Coke->Pink Doughnut, Fluffy Zombie->Turqoise Wine, Spotted Pellegrino->Turqoise Cookie, Regular Chocolate Milk->White Piglet, Spotted Pellegrino->Green Apple Juice, Big Cinnabon->Regular Daikon, Turqoise Pigman->Brown Turnip, Orange Dog->Green Vichy, Orange Coke->White Carrot, Turqoise Pigman->Fluffy Banana, Purple Apple Juice->Turqoise Parsnip, Green Creeper->Orange Pellegrino, Small Chocolate bar->Fluffy Horse, Blue Turnip->White Chicken, Turqoise Pigman->Orange Parsnip, Spotted Pellegrino->Fluffy Cinnabon, Spotted Dog->Red Coke, Big Beer->Orange Pigman, Blue Banana->Small Chocolate bar, Green Creeper->Green Apple Juice, Brown Cinnabon->Green Potato, Red Dog->Red Dog, Brown Cinnabon->Brown Corn, Yellow Gummy bears->Purple Twinkie, Turqoise Sheep->Yellow Gummy bears, White Piglet->Red Spider, Pink Chocolate bar->Big Banana, Regular Wine->Red Pellegrino, Regular Wine->Spotted Orange Juice, Big Cat->Big Banana, Red Wine->Small Mountain Dew, Pink Chocolate bar->Purple Apple Juice, Brown Zombie->Yellow Gummy bears, Big Horse->Purple Potato, Pink Skeleton->Brown Turnip, Big Fanta->Regular Pigman, Small Spite->Pink Creeper, Yellow Corn->Purple Piglet, Spotted Dog->Yellow Zombie, Brown Perrier->Turqoise Parsnip, Orange Pepsi->Turqoise Spider, Pink Apple Juice->Red Pellegrino, Green Doughnut->Purple Doughnut, Green Vichy->Big Zombie, Regular Wine->Regular Sheep, Red Pepsi->Brown Cat, Big Corn->Green Potato, Yellow Horse->Brown Banana, Orange Coke->Green Apple Juice, Orange Pellegrino->Turqoise Coke, Yellow Cat->Big Cinnabon, Regular Chocolate Milk->Red Cookie, Purple Apple Juice->Big Milk, Yellow Gummy bears->Small Twinkie, Yellow Corn->Yellow Milk, Turqoise Spider->Pink Spite, Pink Carrot->Spotted Coke, Big Cinnabon->Small Apple Juice, Big Cat->Fluffy Corn, Spotted Dog->Brown Turnip, Turqoise Dog->Small Carrot, Big Milk->Fluffy Fanta, Blue Cinnabon->Pink Chicken, Turqoise Pigman->Brown Cinnabon, Brown Perrier->Brown Banana, Turqoise Wine->Spotted Chocolate Milk, Spotted Daikon->Purple Piglet, Turqoise Parsnip->Small Apple Juice, Blue Cinnabon->Turqoise Spider, Yellow Cucumber->Pink Chocolate bar, White Doughnut->White Potato, Green Potato->Fluffy Milk, Orange Cookie->Big Milk, Yellow Banana->Brown Fanta, Brown Banana->Brown Beer, Pink Chocolate bar->Pink Apple Juice, Spotted Pepsi->Fluffy Cinnabon, Big Turnip->Green Potato, Turqoise Pellegrino->Big Fanta, Spotted Wine->Big Fanta, Blue Cinnabon->Yellow Banana, Red Wine->Orange Chocolate Milk, Fluffy Horse->Fluffy Cinnabon, Red Pellegrino->Blue Banana, Green Piglet->Spotted Pepsi, Orange Dog->Spotted Pigman, Yellow Corn->Purple Spite, Yellow Cat->Small Creeper, Small Potato->Regular Chocolate Milk, Red Chocolate Milk->Green Carrot, Brown Fanta->Big Milkshake, Brown Fanta->Blue Gummy bears, Purple Chicken->Green Vichy, Regular Sheep->Turqoise Pepsi, Regular Coke->Brown Cat, Big Turnip->Blue Milk, Small Doughnut->Purple Bell Pepper, Brown Beer->Green Creeper, Turqoise Coke->Pink Skeleton, Spotted Dog->Turqoise Wine, Turqoise Wine->Red Pellegrino, Yellow Gummy bears->Green Creeper, Orange Sheep->Red Orange Juice, Red Wine->White Skeleton, Blue Zombie->Red Orange Juice, Green Potato->Brown Turnip, Blue Cat->Small Apple Juice, Red Pepper->Green Creeper, Big Perrier->Orange Dog, Turqoise Pellegrino->Green Creeper, White Twinkie->Blue Cinnabon, Green Vichy->Green Skeleton, Turqoise Pigman->Orange Chocolate Milk, Yellow Perrier->Green Chicken, White Vichy->Red Wine, Purple Potato->Fluffy Corn, Pink Creeper->Small Spite, Big Cinnabon->Blue Gummy bears, Red Parsnip->White Twinkie, Regular Chocolate Milk->Blue Milk, Red Chocolate Milk->Yellow Milkshake, Spotted Cookie->Regular Cookie, Big Beer->Orange Chocolate Milk, Regular Spider->Big Corn, Turqoise Dog->White Twinkie, Blue Milk->Brown Beer, Purple Potato->Green Potato, Yellow Corn->Brown Beer, Regular Cookie->Green Doughnut, Yellow Milkshake->White Vichy, Brown Corn->Big Horse, Brown Turnip->Regular Pigman, Purple Apple Juice->Turqoise Dog, Big Cucumber->Yellow Beer, Fluffy Turnip->Green Vichy, Red Daikon->Spotted Pepper, Purple Potato->Orange Orange Juice, Small Mountain Dew->Purple Potato, Red Wine->Pink Spite, Orange Daikon->Yellow Milkshake, Big Milkshake->Green Bell Pepper, Red Sheep->Yellow Fanta, Red Pepsi->Fluffy Gummy bears, Spotted Pepper->Turqoise Chocolate Milk, Green Piglet->Green Skeleton, Brown Horse->Spotted Wine, Fluffy Cat->Small Potato, Fluffy Cat->Fluffy Cucumber, Spotted Pigman->Red Daikon, Small Carrot->Pink Spite, Brown Cinnabon->Brown Cat, Regular Pepper->Turqoise Dog, Red Wine->Red Wine, Pink Apple Juice->Turqoise Parsnip, Fluffy Banana->Big Corn, Purple Vichy->Orange Pigman, Small Doughnut->Small Doughnut, Small Carrot->Blue Zombie, Brown Turnip->Spotted Sheep, Yellow Perrier->Pink Carrot, Small Spite->Regular Dog, Purple Spite->Blue Zombie, White Vichy->Purple Chocolate bar, Purple Twinkie->Green Bell Pepper, White Doughnut->Yellow Zombie, Pink Spite->Green Doughnut, Turqoise Parsnip->Big Milkshake, Small Vichy->Brown Banana, Turqoise Parsnip->Yellow Cat, Orange Daikon->Small Twinkie, Regular Cookie->Small Carrot, Blue Turnip->Yellow Gummy bears, White Chicken->Yellow Horse, Orange Chocolate Milk->Small Piglet, Regular Pepsi->Orange Wine, Fluffy Corn->Orange Coke, Blue Milk->White Vichy, Regular Dog->Red Spider, Small Chocolate bar->White Chicken, Brown Cinnabon->Turqoise Dog, Fluffy Turnip->Small Twinkie, White Chocolate bar->Green Vichy]}", coverage.getStatePairs().toString());
    assertEquals("Step total count", 8643, coverage.getTotalSteps());
    assertEquals("Variable value total count", 74, coverage.getValueCount());
    assertEquals("Step coverage", "{50cents=3339, 20cents=2362, vend=887, 10cents=2055}", coverage.getStepCoverage().toString());
    assertEquals("Step pair coverage", "[.osmo.tester.start.step->50cents, 50cents->50cents, 50cents->20cents, 20cents->50cents, 50cents->vend, vend->50cents, 20cents->10cents, 10cents->20cents, 20cents->20cents, 20cents->vend, 50cents->10cents, 10cents->50cents, 10cents->vend, .osmo.tester.start.step->20cents, vend->20cents, vend->10cents, .osmo.tester.start.step->10cents, 10cents->10cents]", coverage.getStepPairs().toString());
    assertEquals("Variable coverage", "[coins, bottles]", coverage.getVariables().toString());
    assertEquals("Variable value coverage", "{coins=[50, 100, 150, 200, 250, 270, 320, 160, 210, 230, 240, 260, 280, 135, 185, 195, 245, 295, 305, 120, 20, 70, 140, 190, 290, 340, 180, 300, 130, 40, 10, 60, 80, 90, 75, 95, 145, 155, 165, 215, 265, 45, 55, 105, 125, 110, 170, 220, 330, 115, 175, 235, 255, 15, 65, 30, 310, 225, 85, 205, 275, 285, 5, 25, 35, 325, 315, 335, 345, 0], bottles=[10, 9, 8, 7]}", coverage.getVariableValues().toString());
  }

  private static class MyModelFactory implements ModelFactory {
    @Override
    public void createModelObjects(TestModels addHere) {
      addHere.add(new CalculatorModel());
    }
  }

  private static class MyIterationListener implements IterationListener {
    private int count = 0;
    private int finished = 0;
    private List<TestCase> finalTests = null;

    @Override
    public void iterationDone(List<TestCase> tests) {
      count++;
    }

    @Override
    public void generationDone(List<TestCase> tests) {
      finished++;
      finalTests = tests;
    }
  }
}
